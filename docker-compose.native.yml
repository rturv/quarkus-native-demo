version: '3.8'

services:
  quarkus-native-app:
    image: quarkus-recipes:native
    container_name: quarkus-recipes-native
    ports:
      - "8080:8080"
    environment:
      # Base de datos PostgreSQL Neon (real)
      QUARKUS_DATASOURCE_DB_KIND: postgresql
      QUARKUS_DATASOURCE_USERNAME: neondb_owner
      QUARKUS_DATASOURCE_PASSWORD: npg_wHpyzmq02ZDW
      QUARKUS_DATASOURCE_JDBC_URL: "jdbc:postgresql://ep-black-wind-a94um1q6-pooler.gwc.azure.neon.tech/neondb?sslmode=require&channel_binding=require"
      
      # Hibernate ORM
      QUARKUS_HIBERNATE_ORM_DATABASE_GENERATION: update
      QUARKUS_HIBERNATE_ORM_LOG_SQL: "false"
      
      # HTTP
      QUARKUS_HTTP_HOST: "0.0.0.0"
      QUARKUS_HTTP_PORT: "8080"
      
      # Logging
      QUARKUS_LOG_LEVEL: "INFO"
      QUARKUS_LOG_CONSOLE_ENABLE: "true"
      
      # Security JWT
      APP_SECURITY_JWT_SECRET: ZGVtb19zZWNyZXQ=
      APP_SECURITY_JWT_EXPIRATION_MINUTES: "30"
      QUARKUS_SMALLRYE_JWT_ENABLED: "true"
      QUARKUS_SMALLRYE_JWT_SIGN_KEY: ZGVtb19zZWNyZXQ=
      MP_JWT_VERIFY_SECRET: ZGVtb19zZWNyZXQ=
      QUARKUS_SMALLRYE_JWT_SIGNATURE_ALGORITHM: HS256
      
      # CORS
      QUARKUS_HTTP_CORS: "true"
      QUARKUS_HTTP_CORS_ORIGINS: "*"
      QUARKUS_HTTP_CORS_METHODS: "GET,POST,PUT,DELETE,OPTIONS"
      QUARKUS_HTTP_CORS_HEADERS: "accept,authorization,content-type,x-requested-with"
      
      # Swagger UI
      QUARKUS_SWAGGER_UI_ALWAYS_INCLUDE: "true"
      QUARKUS_SWAGGER_UI_PATH: "/swagger-ui"
      
      # Health checks
      QUARKUS_SMALLRYE_HEALTH_ROOT_PATH: "/health"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/q/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    restart: unless-stopped
    networks:
      - quarkus-network

networks:
  quarkus-network:
    driver: bridge
